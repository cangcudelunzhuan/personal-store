import Nerv from "nervjs";
import Taro from "@tarojs/taro-h5";
import { ScrollView } from '@tarojs/components';


const noop = d => d;

class Paginator extends Taro.Component {
  render() {
    const {
      children: children
    } = this.props;
    const {
      url,

      onDeal = noop,
      callback = noop,
      params = {},
      setParams = noop,
      pageSize = 15
    } = this.props;


    /**
     * 分页参数
     */
    const [pageParams, setPageParams] = Taro.useState({ pageNo: 1, pageSize });
    /**
     * 分页列表状态
     */
    const [listStatus, setListStatus] = Taro.useState({
      // 是否还有下一页数据
      hasMore: true,
      // 正在加载下一页数据
      loadingMore: false
    });

    /**
     * 加载
     */
    const fetchData = function () {
      const fetchParams = setParams(Object.assign({}, pageParams, params));

      listStatus.loadingMore = true;
      setListStatus({ ...listStatus });

      url(fetchParams).then(resModel => {
        const listData = onDeal(resModel);
        if (Array.isArray(listData)) {
          pageParams.pageNo = pageParams.pageNo;

          setPageParams(pageParams);

          listStatus.loadingMore = false;
          setListStatus({ ...listStatus });

          callback(listData);
        }
      });
    };

    Taro.useEffect(function () {
      // fetchData();
    }, [params]);

    return <ScrollView scrollY>
      {children}
    </ScrollView>;
  }

}

export default Paginator;